<!doctype html>

<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Time Capsule ‚Äî Minimal & Elegant</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{--bg:#0f1724;--card:#0b1220;--accent:#7c3aed;--muted:#9aa4b2;--glass:rgba(255,255,255,0.04)}
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#071129 0%, #0f1724 100%);color:#e6eef8;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px}
  .wrap{width:100%;max-width:920px;display:grid;grid-template-columns:1fr 420px;gap:28px}
  .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);padding:28px;border-radius:16px;backdrop-filter:blur(6px)}
  h1{margin:0 0 8px;font-size:1.5rem}
  p.lead{margin:0 0 18px;color:var(--muted)}label{display:block;font-weight:600;margin-top:12px;color:#dbeafe} input[type=text],textarea,input[type=date],input[type=time],input[type=datetime-local],input[type=password]{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;margin-top:8px} textarea{min-height:120px;resize:vertical} .row{display:flex;gap:8px;margin-top:12px} .btn{padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700} .btn.primary{background:linear-gradient(90deg,var(--accent),#4f46e5);color:white} .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)} .small{font-size:0.86rem;color:var(--muted);margin-top:10px}

/* preview card */ .preview{display:flex;flex-direction:column;gap:12px;align-items:stretch} .capsule{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);padding:18px;border-radius:12px} .meta{display:flex;justify-content:space-between;align-items:center} .meta .unlock{font-size:0.95rem;font-weight:700;color:#dbeafe} .countdown{font-size:0.9rem;color:var(--muted)} .linkBox{display:flex;gap:8px;margin-top:12px} .link{flex:1;padding:10px;border-radius:8px;background:var(--glass);border:1px solid rgba(255,255,255,0.03);color:#cfe7ff;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

footer{grid-column:1/-1;text-align:center;margin-top:18px;color:var(--muted);font-size:0.9rem}

@media(max-width:880px){.wrap{grid-template-columns:1fr;}.link{font-size:0.9rem}} </style>

</head>
<body>
  <div class="wrap">
    <div class="panel">
      <h1>Time Capsule</h1>
      <p class="lead">Write a private message, pick a future date and create a secure capsule. Share the link ‚Äî it only opens on the unlock date.</p><label>Message</label>
  <textarea id="message" placeholder="Write your message... (supports plain text, emojis)"></textarea>

  <div style="display:flex;gap:12px;margin-top:12px">
    <div style="flex:1">
      <label>Unlock date</label>
      <input id="date" type="date" />
    </div>
    <div style="width:160px">
      <label>Unlock time (optional)</label>
      <input id="time" type="time" />
    </div>
  </div>

  <label>Optional password (leave empty to generate)</label>
  <input id="password" type="text" placeholder="Password for extra security (optional)" />

  <div class="row">
    <button id="createBtn" class="btn primary">Create Capsule</button>
    <button id="previewBtn" class="btn ghost">Preview</button>
  </div>
  <div class="small">Note: This demo stores capsules in your browser's <strong>localStorage</strong>. For sharing online, you can host with a server or use Firebase/Supabase.</div>
</div>

<div class="panel preview">
  <div class="capsule">
    <div class="meta"><div class="unlock">Preview Capsule</div><div class="countdown" id="countdown">Not created yet</div></div>
    <div id="previewMsg" style="margin-top:12px;color:#cfe7ff;min-height:52px">Your message preview will appear here after preview.</div>
    <div class="linkBox" id="linkBox" style="display:none">
      <div class="link" id="linkText">-</div>
      <button id="copyBtn" class="btn ghost">Copy</button>
    </div>
  </div>
</div>

<footer>Made with care ‚Äî Time Capsule Demo</footer>

  </div><script>
  // simple base64 encode/decode for demo (not secret-grade). For real security use crypto.subtle
  const enc = s => btoa(unescape(encodeURIComponent(s)));
  const dec = s => decodeURIComponent(escape(atob(s)));

  function genId(){return Date.now().toString(36) + Math.random().toString(36).slice(2,9)}
  function genPassword(len=16){const chars='ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789!@#$%^&*()';let o='';const a=new Uint32Array(len);crypto.getRandomValues(a);for(let i=0;i<len;i++)o+=chars[a[i]%chars.length];return o}

  const createBtn = document.getElementById('createBtn');
  const previewBtn = document.getElementById('previewBtn');
  const copyBtn = document.getElementById('copyBtn');

  createBtn.addEventListener('click', ()=>{
    const msg = document.getElementById('message').value.trim();
    const date = document.getElementById('date').value;
    const time = document.getElementById('time').value;
    if(!msg || !date){return alert('Please enter message and unlock date.')}
    const pwdInput = document.getElementById('password').value.trim();
    const password = pwdInput || genPassword(18);
    const id = genId();
    // store encrypted payload (simple base64 here)
    const payload = {msg:enc(msg), date, time, password};
    localStorage.setItem('capsule_'+id, JSON.stringify(payload));
    const url = location.origin + location.pathname + '?id='+id;
    showLink(url);
    alert('Capsule created! Share the link and the password separately if you used one.');
  });

  previewBtn.addEventListener('click', ()=>{
    const msg = document.getElementById('message').value.trim();
    const date = document.getElementById('date').value;
    const time = document.getElementById('time').value;
    if(!msg || !date){return alert('Please enter message and unlock date for preview.')}
    document.getElementById('previewMsg').textContent = msg;
    updateCountdown(date, time);
  });

  copyBtn.addEventListener('click', ()=>{
    const txt = document.getElementById('linkText').textContent;
    navigator.clipboard.writeText(txt).then(()=>{copyBtn.textContent='Copied!';setTimeout(()=>copyBtn.textContent='Copy',1200)});
  });

  function showLink(url){
    const box = document.getElementById('linkBox');
    document.getElementById('linkText').textContent = url;
    box.style.display = 'flex';
    updateCountdownFromUrl(url);
  }

  function updateCountdown(date, time){
    const now = new Date();
    const dt = (time? new Date(date+'T'+time) : new Date(date+'T00:00'));
    const diff = dt - now;
    const el = document.getElementById('countdown');
    if(diff<=0){el.textContent='Unlocked';return}
    const days = Math.floor(diff/(1000*60*60*24));
    const hrs = Math.floor((diff%(1000*60*60*24))/(1000*60*60));
    const mins = Math.floor((diff%(1000*60*60))/(1000*60));
    el.textContent = `${days}d ${hrs}h ${mins}m to unlock`;
  }

  // if page loaded with ?id=... show capsule viewer
  window.onload = ()=>{
    const params = new URLSearchParams(location.search);
    const id = params.get('id');
    if(id){
      const data = localStorage.getItem('capsule_'+id);
      if(!data){document.body.innerHTML='<div style="padding:40px;color:#ffdede;background:#2b0b0b;border-radius:12px;margin:40px">Capsule not found.</div>';return}
      const obj = JSON.parse(data);
      const now = new Date();
      const unlock = obj.time? new Date(obj.date+'T'+obj.time) : new Date(obj.date+'T00:00');
      if(now < unlock){
        document.body.innerHTML = `<div style="max-width:680px;margin:40px auto;padding:24px;background:#071129;border-radius:12px;color:#cfe7ff">\n          <h2 style=\"margin-top:0\">‚è≥ Capsule locked</h2>\n          <p>This capsule will unlock on <strong>${obj.date}${obj.time? ' at '+obj.time : ''}</strong>.</p>\n          <p style=\"color:#9aa4b2\">Come back later or use the original creator to preview.</p>\n        </div>`;
        return;
      }
      // unlocked ‚Äî ask for password if set
      if(obj.password){
        const userPwd = prompt('Enter password to open this capsule:');
        if(userPwd !== obj.password){alert('Incorrect password.'); location.href = location.origin + location.pathname; return}
      }
      const message = dec(obj.msg);
      document.body.innerHTML = `<div style=\"max-width:820px;margin:40px auto;padding:28px;background:linear-gradient(180deg,#071129,#0b1220);border-radius:12px;color:#e6eef8\">\n        <h1 style=\"margin:0 0 8px\">üìú Your Time Capsule</h1>\n        <div style=\"background:rgba(255,255,255,0.02);padding:18px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)\">${escapeHtml(message)}</div>\n      </div>`;
    }
  }

  function updateCountdownFromUrl(url){
    // show approximate countdown using inputs
    const d = document.getElementById('date').value;
    const t = document.getElementById('time').value;
    if(d) updateCountdown(d,t);
  }

  function escapeHtml(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br/>')}
</script></body>
                                                                                             </html>
